import type { Mod } from 'bridge/BridgeAPI';
import {
  usePersistentDialog,
  usePersistentDialogContext,
} from 'renderer/react/context/DialogContext';
import useModConfigOverride from 'renderer/react/context/hooks/useModConfigOverride';
import useModUpdate from 'renderer/react/context/hooks/useModUpdate';
import getNexusModID from 'renderer/react/context/utils/getNexusModID';
import ModListMenuItem from 'renderer/react/modlist/ModListMenuItem';
import { useCallback, useState } from 'react';
import {
  Button,
  Dialog,
  DialogActions,
  DialogContent,
  DialogContentText,
  TextField,
  createSvgIcon,
} from '@mui/material';

const NexusMods = createSvgIcon(
  <svg
    height="24"
    style={{
      filter: 'grayscale(100%)',
      transformOrigin: 'center',
      transform: 'scale(0.8)',
    }}
    viewBox="0 0 1024 1024"
    width="24"
    xmlns="http://www.w3.org/2000/svg"
  >
    <path
      d="M677.49,2.29 C678.24,1.76 679,1.23 679.77,0.69 C685.98,0.83 692.19,0.8 698.4,0.69 C699.22,1.18 700.05,1.67 700.88,2.17 C703.3,2.17 705.86,1.84 708.08,3.06 C710.01,3.24 712.01,3.28 713.81,4.1 C715.2,4.35 716.63,4.56 717.98,5.07 C720.01,5.6 722.01,6.25 724.03,6.82 C729.69,8.73 735.33,10.77 740.79,13.2 C748.81,16.54 756.61,20.43 764.07,24.9 C773.28,29.81 782.09,35.49 790.88,41.13 C791.77,41.97 792.78,42.64 793.93,43.13 C796.46,45.28 799.34,46.96 802.11,48.79 C806.57,52.42 811.53,55.42 815.95,59.12 C828.33,68.27 839.99,78.31 851.75,88.23 C854.47,90.82 856.76,93.93 860.1,95.82 C867.55,102.42 874.38,109.66 881.48,116.63 C885.25,120.3 887.97,124.86 890.95,129.17 C895.73,136.09 898.45,144.16 901.11,152.08 C902,157.43 903.99,162.63 903.78,168.12 C905.23,172.98 904.59,178.07 904.71,183.06 C904.7,193.73 904.71,204.41 904.71,215.09 C904.76,217.46 903.48,219.64 903.71,222.04 C903.47,224.71 904.51,227.81 902.62,230.09 C902.24,233.08 903.36,236.48 901.41,239.08 C901.44,240.86 901.51,242.64 901.6,244.42 C901.26,244.76 900.57,245.43 900.23,245.77 C900.24,247.13 900.25,248.49 900.24,249.85 C899.28,251.46 899.18,253.32 899.08,255.15 C897.56,260.37 896.74,265.78 894.89,270.92 C894.58,272.33 894.29,273.76 893.81,275.13 C891.73,281.12 890.36,287.34 888.01,293.23 C886.89,297.21 885.2,301 884.08,304.97 C882.74,308.12 880.7,311.55 882.02,315.05 C883.67,319.64 885.74,324.1 886.93,328.85 C888.6,332.42 889.7,336.21 890.98,339.93 C891.27,341.24 891.6,342.57 891.97,343.88 C892.32,344.89 892.7,345.89 893.09,346.9 C893.44,348.27 893.87,349.64 894.38,350.99 C894.64,353.05 895.28,355.05 896.03,356.99 C896.53,358.35 896.73,359.78 896.94,361.22 C897.22,361.85 897.79,363.09 898.07,363.72 C897.68,365.22 898.39,366.59 899,367.9 C899.88,370.94 899.69,374.36 901.39,377.13 C901.42,378.41 901.44,379.7 901.51,381 C902.97,384.21 903.63,387.9 903.72,391.44 C903.98,391.83 904.5,392.62 904.75,393.01 C904.73,394.6 904.72,396.2 904.76,397.81 C907.17,400.4 904.75,404.23 907.22,406.87 C905.92,410.78 908.68,414.17 908.32,418.04 C908.18,420.02 908.39,422.01 909.35,423.79 C909.6,427.21 908.51,431.02 910.45,434.1 C910.86,439.39 909.75,444.85 911.59,449.95 C911.7,464.98 911.51,480.03 911.68,495.07 C911.82,496.22 911.12,497.2 910.55,498.13 C910.45,502.73 910.65,507.34 910.47,511.94 C908.23,515.18 910.06,519.28 909.03,522.84 C908,525.72 908.37,528.82 908.25,531.82 C906.22,534.12 907.71,537.22 906.69,539.85 C905.58,542.51 906.31,545.6 904.85,548.12 C904.45,552.15 904.2,556.43 902.69,560.16 C902.58,561.61 902.52,563.07 902.49,564.54 L901.39,564.53 C901.38,566.32 901.4,568.13 901.49,569.93 C902.43,570.85 903.3,571.89 904.04,573 C909.75,582.01 915.49,591 920.94,600.17 C923.04,604.56 925.93,608.54 927.88,613.02 C930.58,618.16 932.96,623.47 935.17,628.83 C935.47,629.33 936.06,630.33 936.36,630.83 C939.24,637.88 941.5,645.18 944.54,652.17 C944.54,652.99 944.54,654.62 944.54,655.44 L945.68,655.47 C945.69,656.11 945.7,657.39 945.7,658.03 C946.69,659.19 946.82,660.7 947.09,662.15 C947.64,664.47 948.09,666.86 949.16,669.04 C948.98,672.09 949.71,675.05 950.26,678.02 C950.25,685.01 950.28,692 950.2,698.98 C948.55,700.75 949.41,703.31 949.38,705.46 C948.79,706.23 948.21,707 947.64,707.79 C947.77,708.36 948.02,709.49 948.15,710.06 C946.69,714.31 945.63,718.69 944.37,723.01 C942.13,728.28 940.87,734 938.05,739.04 C937.26,741.74 936.1,744.3 934.72,746.75 C927.06,763.38 917.13,778.79 906.77,793.83 C905.16,796.82 902.71,799.21 900.83,802.01 C896.49,808.71 891.25,814.79 886.6,821.27 C885.54,822.97 884.26,824.52 882.81,825.89 C879.74,830.11 876.42,834.19 872.86,838.01 C871.13,840.23 869.5,842.56 867.46,844.53 C864.08,847.52 861.98,851.64 858.52,854.58 C854.22,858.28 851.15,863.1 847.03,867 C840.01,873.94 833.54,881.61 825.09,886.91 C819.72,891.05 813.33,893.43 807.28,896.36 C806.64,896.35 805.37,896.32 804.74,896.31 L804.62,897.64 C803.97,897.63 802.66,897.62 802.01,897.61 C800.92,898.53 799.45,898.55 798.15,898.89 C796.77,899.62 795.2,899.75 793.69,899.95 C791.1,901.01 788.29,900.84 785.58,900.68 C784.74,901.19 783.91,901.72 783.09,902.26 C777.82,902.62 772.15,901.06 767.16,903.17 C759.44,903.27 751.72,903.27 744.01,903.2 C739.27,901.15 733.91,902.55 728.91,902.26 C728.05,901.7 727.19,901.16 726.35,900.63 C723.52,900.73 720.62,901.1 717.87,900.31 C714.94,899.25 711.62,900.44 708.88,898.79 C706.91,898.49 704.62,898.96 703.03,897.5 C701.39,897.48 699.76,897.51 698.14,897.51 C694.84,895.2 690.13,896.5 686.88,894 C685.21,893.89 683.56,893.65 682,893.1 C678.34,892.33 674.78,891.2 671.14,890.39 C670.14,889.8 669.03,889.39 667.96,889.03 C666.88,888.72 665.8,888.46 664.72,888.25 C655.55,884.7 645.95,882.26 636.97,878.21 C633.19,879.51 629.61,881.38 625.77,882.54 C623.18,883.24 620.81,885.06 618.04,884.88 C615.76,886.88 612.37,886.58 609.91,888.32 C609.39,888.36 608.36,888.44 607.85,888.47 C599.61,891.88 590.68,893.55 582.12,896.07 C580.69,896.33 579.12,896.3 577.97,897.31 C576.16,897.33 574.35,897.51 572.87,898.64 C571.4,898.56 569.94,898.47 568.49,898.39 L568.55,899.68 C567.29,899.69 566.04,899.72 564.8,899.77 C562.85,900.68 560.71,900.87 558.59,900.8 C557.83,901.31 557.08,901.84 556.34,902.38 C555.47,902.21 553.74,901.87 552.87,901.7 C552.06,902.22 551.26,902.76 550.46,903.31 C543.28,903.02 536.37,906.07 529.11,905.51 C526.64,907.85 522.86,905.84 519.87,906.71 C515.46,908.55 510.56,907.3 505.93,907.59 C504,909.25 501.39,908.78 499.05,908.85 C482.69,908.79 466.33,908.85 449.98,908.83 C447.24,908.87 444.81,907.15 442.03,907.63 C438.76,907.26 434.98,908.73 432.18,906.48 C428.42,906.68 424.63,906.9 421.08,905.48 C416.64,905.88 412.49,904.11 408.07,904.26 C406.19,902.78 403.75,903.28 401.57,903.32 C400.73,902.81 399.89,902.32 399.06,901.84 C396.72,902.43 394.35,902.19 392.33,900.84 C390.48,900.79 388.62,900.71 386.92,899.93 C384.84,899.82 382.78,899.5 380.95,898.48 C377.67,900.67 374.6,903.16 371.28,905.3 C361.79,911.67 352.07,917.77 342.02,923.19 C332.14,929.03 321.58,933.55 311.06,938.1 C303.86,941.19 296.37,943.55 288.94,946.02 C284.95,947 281.08,948.84 276.9,948.65 C274.62,950.39 271.67,949.55 269.04,949.74 C266.74,951.53 263.65,950.53 260.98,950.77 C257.01,950.4 252.76,951.62 249.03,949.87 C246.3,949.69 243.42,950.19 240.89,948.92 C237.92,948.62 235.06,947.8 232.16,947.2 C226.93,945.19 221.29,944.49 216.26,941.94 C215.19,941.69 214.16,941.36 213.16,940.94 C199.7,935.66 186.97,928.77 174.52,921.45 C171.5,919.43 168.52,917.33 165.25,915.72 C162.18,913.31 158.49,911.74 155.76,908.92 C155.25,908.8 154.22,908.57 153.71,908.45 C153.36,908.06 152.65,907.27 152.29,906.88 C147.92,904.2 143.58,901.31 139.85,897.8 C139.39,897.68 138.48,897.44 138.02,897.31 C135.96,894.78 132.56,893.78 130.93,890.81 C130.44,890.68 129.46,890.42 128.97,890.29 C128.26,889.58 127.54,888.88 126.82,888.2 C120.49,883.24 113.79,878.66 108.08,872.95 C104.39,871.46 102.44,867.7 99.19,865.59 C94.43,862.39 91.23,857.45 86.51,854.22 C83.48,851.71 80.86,848.77 77.9,846.19 C70.58,838.41 62.17,831.47 56.92,821.99 C55.06,818.23 52.51,814.81 51.13,810.83 C49.44,806.76 48.2,802.54 46.95,798.33 C46.83,796.84 46.5,795.42 45.76,794.14 C45.8,790.34 44.09,786.78 44.7,782.95 C45.19,779.83 43.28,777.09 43.39,774.03 C43.47,761.66 43.44,749.29 43.41,736.93 C43.14,734.17 45.11,731.79 44.67,729.02 C44.09,724.55 46.04,720.35 45.73,715.9 C45.68,714.2 46.64,712.72 47.12,711.15 C46.49,709.04 46.99,707 48.08,705.17 C48.08,703.31 48.12,701.43 49.15,699.82 C49.21,698.49 49.26,697.17 49.28,695.87 C49.58,695.48 50.18,694.71 50.48,694.32 C50.4,693.45 50.25,691.72 50.17,690.86 C50.49,690.48 51.12,689.74 51.43,689.36 C51.45,688.3 51.49,687.24 51.53,686.2 C52.27,685.07 52.67,683.83 52.73,682.49 C52.95,682.13 53.39,681.41 53.6,681.05 C53.08,677.34 56.13,674.45 56.06,670.85 C57.07,667.72 58.15,664.62 59.1,661.48 C59.42,660.28 59.87,659.14 60.45,658.07 C60.47,657.42 60.51,656.14 60.52,655.5 L61.58,655.47 C61.62,654.88 61.7,653.71 61.74,653.13 C63.93,648.57 65.27,643.68 67.1,638.99 C67.99,636.67 69.27,634.45 69.71,632 C69.15,630.34 68.33,628.78 67.63,627.19 C62.51,613.01 57.77,598.71 53.92,584.13 C53.22,581.37 52.92,578.42 51.49,575.92 C51.44,574.65 51.43,573.39 51.4,572.14 C50.24,570.95 50.29,569.29 50.1,567.78 C49.4,565.97 49.21,564.03 49.05,562.12 C47.5,559.63 48.26,556.57 47.04,553.98 C46.54,549.94 45.63,545.97 45.03,541.95 C44.26,539.38 45.41,536.35 43.52,534.17 C43.45,532.05 43.45,529.93 43.43,527.82 C41.49,524.84 42.59,521.13 42.43,517.81 C40.39,515.31 41.46,511.94 41.25,509.01 C41.61,505.59 40.05,502.39 40.21,499 C40.26,481.33 40.24,463.65 40.22,445.98 C40.11,444.55 40.49,443.17 41.16,441.93 C41.8,437.6 39.98,432.67 42.31,428.75 C42.39,425.86 42.31,422.97 42.45,420.08 C44.09,418 43.21,415.29 43.52,412.88 C45.08,408.11 45.13,403 45.85,398.05 C46.86,396.15 46.88,394 46.88,391.91 C47.3,391.01 47.73,390.12 48.15,389.23 C47.93,387.41 47.99,385.6 48.16,383.79 C37.02,367.88 27.24,351.03 18.61,333.65 C18.47,333.23 18.19,332.41 18.04,331.99 C16.05,328.15 14.38,324.16 12.82,320.13 C10.77,314.79 8.31,309.61 6.85,304.07 C5.14,298.83 2.88,293.61 2.41,288.09 C1.02,286.33 1.44,284.1 1.37,282.03 C0.62,280.8 0.12,279.44 0.27,277.99 C0.26,270.97 0.3,263.96 0.25,256.95 C0.13,255.28 0.74,253.73 1.22,252.19 C1.51,250.09 1.25,247.88 2.35,245.97 C3.58,237.8 6.8,230.02 9.35,222.17 C12.45,215.62 14.78,208.73 18.32,202.39 C21.46,196.44 24.55,190.42 28.27,184.8 C29.54,182.08 31.52,179.76 32.72,177 C34.24,174.75 35.72,172.49 37.23,170.25 C44.25,159.13 52.13,148.59 60.03,138.1 C69.87,124.7 81.07,112.44 91.77,99.77 C94.56,96.62 97.92,94.02 100.62,90.8 C109.63,79.73 120.25,69.78 132.91,63 C137.3,60.34 142.19,58.53 147.03,56.81 C148.35,56.54 149.86,56.63 150.91,55.61 C154.28,54.87 157.7,54.37 161.02,53.43 C164.35,53.01 167.82,53.7 170.98,52.24 C186.01,52.11 201.06,52.28 216.1,52.17 C217.22,52.17 218.32,52.34 219.39,52.68 C223.23,54.01 227.47,52.37 231.2,54.27 C237.75,54.06 243.99,56.43 250.44,56.56 C250.81,56.86 251.53,57.45 251.9,57.75 C252.71,57.71 254.34,57.63 255.15,57.59 C256.66,58.52 258.38,58.86 260.12,59.08 C261.64,59.57 263.21,59.83 264.8,59.95 C265.32,60.27 266.37,60.9 266.89,61.22 C268.36,61.18 269.83,61.39 271.24,61.85 C272.48,62.29 273.75,62.71 274.97,63.23 C277.1,63.61 279.19,64.18 281.29,64.74 C283.46,65.69 285.74,66.38 288.02,67.01 C290.3,67.98 292.66,68.74 295.05,69.36 C295.42,69.57 296.15,69.97 296.52,70.17 C298.85,70.44 301.15,71.23 303.01,72.71 C309.52,69.89 316.26,67.6 322.68,64.59 C323.34,64.57 324.65,64.54 325.3,64.52 C325.34,64.32 325.42,63.91 325.46,63.7 C329.98,62.29 334.39,60.54 338.89,59.05 C339.92,58.69 340.95,58.32 341.99,57.94 C343.26,57.63 344.53,57.28 345.76,56.77 C347.79,56.12 349.84,55.49 351.97,55.17 C355.56,53.67 359.45,53.19 363.13,51.95 C365.37,51.12 367.71,50.65 370.01,50.01 C374.35,49.26 378.53,47.76 382.91,47.29 C384.4,46.17 386.32,46.4 388.08,46.18 C389.89,45.14 392.01,45.35 394.02,45.25 C395.83,43.89 398.1,44.2 400.23,44.22 C401.06,43.69 401.89,43.16 402.73,42.63 C403.59,42.81 405.3,43.15 406.16,43.32 C407.34,42.78 408.54,42.23 409.73,41.67 C411.48,41.71 413.23,41.75 414.99,41.77 C415.37,41.48 416.14,40.89 416.52,40.6 C419.16,40.67 421.92,41.12 424.46,40.16 C427.79,38.93 431.41,39.71 434.87,39.51 C435.18,39.26 435.81,38.77 436.12,38.52 C440.48,38.32 444.85,38.58 449.22,38.4 C450.38,37.75 451.6,37.08 453,37.25 C467.66,37.25 482.31,37.28 496.97,37.23 C499.03,37.05 500.94,37.91 502.9,38.37 C506.88,38.63 510.88,38.32 514.87,38.5 C517.95,40.32 521.67,39.29 525.05,39.49 C527.69,41.46 531.1,40.57 534.15,40.73 C536.75,42.33 539.89,41.36 542.69,42.25 C545.43,43.01 548.41,42.81 551.01,44.1 C553.06,44.13 555.22,43.98 557,45.22 C559.05,45.32 561.2,45.21 563.08,46.21 C564.5,46.29 565.95,46.34 567.39,46.4 L567.35,47.52 C570.3,47.57 573.25,47.72 576.21,47.64 C576.57,47.12 577.3,46.08 577.67,45.56 C578.93,45.29 580.05,44.7 580.91,43.72 C584.65,41.55 588,38.77 591.94,36.96 C595.5,34.41 599.25,32.12 603.2,30.22 C607.9,27.11 613.02,24.67 618.06,22.17 C623.13,19.32 628.66,17.45 633.84,14.86 C635.29,14.31 636.72,13.72 638.18,13.18 C642.67,10.94 647.61,9.85 652.22,7.93 C654.47,7.22 656.83,6.77 658.93,5.64 C659.45,5.58 660.51,5.46 661.04,5.4 C662.2,4.38 663.77,4.45 665.21,4.2 C666.65,3.34 668.31,3.18 669.96,3.02 C672.34,1.96 674.95,2.13 677.49,2.29 Z"
      fill="#242021"
      id="Shape"
    />
    <path
      d="M643.89,100.92 C657.42,93.13 671.91,87 686.95,82.8 C690.66,82.18 694.38,83.41 697.97,84.3 C716.63,90.2 733.23,100.93 749.4,111.69 C772.39,127.64 794.28,145.28 814.25,164.91 C816.62,167.03 818.93,169.25 820.87,171.79 C818.53,171.56 816.21,171.27 813.88,171 C796.6,169.12 779.57,174.4 763.83,181.04 C746.11,189.05 729.76,199.86 714.74,212.17 C712.42,214.01 710.2,215.98 708.02,217.98 C704.21,220.07 701.75,223.78 698.56,226.63 C694.59,230.27 691.08,234.44 686.61,237.49 C681.2,244.06 675.23,250.2 668.95,255.92 C663.31,263.83 656.86,271.13 650.86,278.76 C645.15,286.44 639.78,294.36 634.09,302.06 C632.75,303.89 631.71,305.91 630.71,307.94 C624.1,316.13 619.29,325.64 614.25,334.85 C612.59,339.25 609.16,343.08 609.25,348.01 C615.05,350.48 620.46,353.77 626.04,356.7 C635.59,361.57 645.03,366.66 654.34,372 C648.59,375.36 642.02,376.83 636.11,379.85 C628.78,381.99 622.04,385.66 614.73,387.82 C605.59,391.9 596.03,395 586.84,398.99 C574.63,403.3 562.8,408.57 550.66,413.06 C534.37,419.32 518.32,426.25 501.71,431.63 C498.76,428.56 499.07,423.8 498.07,419.9 C495.07,411.43 493,402.66 490.7,393.99 C489.7,390.5 488.62,387.03 488.09,383.43 C487.59,382.68 487.09,381.94 486.6,381.2 C485.9,374.19 483,367.69 481.7,360.8 C480.8,356.03 478.64,351.59 478.15,346.73 C477.87,346.28 477.29,345.37 477,344.92 C476.31,338.91 474.06,333.26 472.6,327.43 C469.01,313.27 465.24,299.15 461.27,285.08 C460.03,279.02 457.86,273.17 457.08,267.02 C461.36,267.59 464.71,270.34 468.36,272.38 C474.74,275.05 480.49,278.95 486.76,281.85 C490.41,283.46 493.56,286.19 497.57,286.96 C509.82,258.96 523.24,231.39 539.33,205.36 C540.06,204.1 540.62,202.75 541.23,201.42 C545.55,196.24 548.67,190.22 552.61,184.76 C557.9,177.37 563.04,169.84 569.06,163 C573.45,157.99 577.36,152.56 582.07,147.84 C585.2,144.68 588.37,141.55 591.5,138.38 C600.2,130.26 609.53,122.81 619.49,116.29 C627.68,111.26 635.44,105.53 643.89,100.92 Z"
      fill="#FEFEFE"
      id="Shape"
    />
    <path
      d="M393.04,128.54 C418.52,122.19 444.77,119.57 470.96,118.7 C511.81,118.63 552.98,124.48 591.5,138.38 C588.37,141.55 585.2,144.68 582.07,147.84 C577.36,152.56 573.45,157.99 569.06,163 C563.04,169.84 557.9,177.37 552.61,184.76 C548.67,190.22 545.55,196.24 541.23,201.42 C540.62,202.75 540.06,204.1 539.33,205.36 C523.24,231.39 509.82,258.96 497.57,286.96 C493.56,286.19 490.41,283.46 486.76,281.85 C480.49,278.95 474.74,275.05 468.36,272.38 C464.71,270.34 461.36,267.59 457.08,267.02 C457.86,273.17 460.03,279.02 461.27,285.08 C465.24,299.15 469.01,313.27 472.6,327.43 C474.06,333.26 476.31,338.91 477,344.92 C477.29,345.37 477.87,346.28 478.15,346.73 C478.64,351.59 480.8,356.03 481.7,360.8 C483,367.69 485.9,374.19 486.6,381.2 C487.09,381.94 487.59,382.68 488.09,383.43 C488.62,387.03 489.7,390.5 490.7,393.99 C493,402.66 495.07,411.43 498.07,419.9 C499.07,423.8 498.76,428.56 501.71,431.63 C518.32,426.25 534.37,419.32 550.66,413.06 C562.8,408.57 574.63,403.3 586.84,398.99 C596.03,395 605.59,391.9 614.73,387.82 C622.04,385.66 628.78,381.99 636.11,379.85 C642.02,376.83 648.59,375.36 654.34,372 C645.03,366.66 635.59,361.57 626.04,356.7 C620.46,353.77 615.05,350.48 609.25,348.01 C609.16,343.08 612.59,339.25 614.25,334.85 C619.29,325.64 624.1,316.13 630.71,307.94 C631.71,305.91 632.75,303.89 634.09,302.06 C639.78,294.36 645.15,286.44 650.86,278.76 C656.86,271.13 663.31,263.83 668.95,255.92 C675.23,250.2 681.2,244.06 686.61,237.49 C691.08,234.44 694.59,230.27 698.56,226.63 C701.75,223.78 704.21,220.07 708.02,217.98 C710.2,215.98 712.42,214.01 714.74,212.17 C726.88,220.99 735.94,233.12 746.03,244.04 C749.87,247.93 752.83,252.55 756.48,256.6 C763.94,266.94 771.56,277.21 777.85,288.33 C781.82,293.85 784.85,299.95 788.19,305.86 C790.77,310.57 792.21,315.86 795.33,320.29 C810.65,351.34 820.64,384.98 826,419.15 C829.94,444.21 830.37,469.67 829.35,494.97 C827.48,526.33 821.55,557.53 811.21,587.2 C783.46,559.03 749.57,537.8 714.83,519.37 C706.51,514.54 697.61,510.85 689.05,506.49 C681.72,502.71 674.21,499.27 666.56,496.19 C664.95,495.71 664.61,494.07 664.27,492.67 C665.24,491.91 666.22,491.16 667.2,490.41 C670.01,482.18 675.17,475 678.8,467.11 C680.55,462.95 683.47,459.4 684.94,455.1 C682.27,455.05 679.59,455.25 677.13,456.31 C634.34,467.65 591.57,479.23 548.86,490.86 C539.12,492.75 529.81,496.42 520.06,498.4 C520.78,501.78 521.78,505.09 522.85,508.39 C526.61,516.99 529.34,526 533.18,534.58 C536.54,543.31 539.63,552.17 543.39,560.75 C554.96,591.37 567.4,621.64 578.81,652.31 C582.52,648.16 584.35,642.84 587.19,638.13 C592.78,627.83 598.25,617.47 603.83,607.15 C605.79,607.37 607.82,607.56 609.57,608.59 C614.69,611.41 620.19,613.53 625.05,616.82 C626.68,617.96 628.6,618.54 630.51,619.08 C636.51,624.2 643.82,627.45 650,632.35 C663.4,641 676.01,650.82 688.16,661.15 C693.6,664.97 697.84,670.25 703.45,673.83 C705.7,676.82 708.29,679.51 711,682.09 C714.57,685.47 717.7,689.35 721.81,692.13 C726.61,698.64 732.46,704.3 737.6,710.55 C735.43,715.5 730.92,718.58 727.34,722.4 C717.04,734.16 704.36,743.4 692.51,753.48 C687.52,758.02 681.51,761.18 676.16,765.24 C663.38,774.81 649.46,782.69 635.12,789.68 C592.83,811.18 546.1,823.86 498.75,826.78 C486.57,828.14 474.26,827.26 462.03,827.47 C431.76,825.93 401.51,821.26 372.5,812.27 C368.9,811.2 365.2,810.3 361.87,808.49 C372.68,797.21 382.92,785.33 391.7,772.39 C392.77,770.81 393.95,769.3 395.13,767.81 C395.38,766.94 395.63,766.08 395.89,765.24 C400.63,761.28 403.03,755.49 406.59,750.6 C410,745.79 412,740.16 415.39,735.33 C420.84,726.26 425.42,716.68 430.96,707.67 C432.46,702.56 435.62,698.17 437.4,693.16 C441.07,686.59 444.15,679.73 447.05,672.79 C447.56,672.62 448.58,672.28 449.08,672.11 C449.33,669.79 449.6,667.48 449.89,665.18 C454.82,665.56 458.91,668.46 463.22,670.58 C472.53,675.37 481.43,681.01 490.98,685.31 C490.87,677.56 487.7,670.39 485.97,662.96 C480.65,643.54 475.83,624 470.35,604.63 C469.83,602.67 469.04,600.8 468.19,598.97 C466.28,587.54 462.18,576.6 459.85,565.25 C457.53,560.03 457.07,554.27 455.44,548.85 C452.53,539.51 450.19,530.01 448.04,520.48 C442.86,519.71 438.74,523.35 434.04,524.76 C425.1,527.74 416.53,531.71 407.66,534.88 C400.14,538.06 392.34,540.51 384.86,543.77 C382.64,544.75 380.35,545.55 378.03,546.24 C369.13,550.23 359.79,553.09 350.86,557 C342.11,560.21 333.34,563.39 324.82,567.19 C317.39,570.03 309.8,572.55 302.63,576.02 C300.6,576.6 298.56,577.17 296.52,577.73 C296.41,578.61 296.21,580.37 296.1,581.24 C310.47,588.63 324.68,596.33 338.85,604.1 C338.6,605.93 338.53,607.87 337.59,609.54 C331.84,620.38 326.58,631.55 319.52,641.63 C308.49,658.33 296.72,674.56 283.82,689.86 C278.38,696.3 272.3,702.18 267.05,708.77 C260.47,714.23 254.25,720.26 248.82,726.88 C244.77,729.56 241.33,733.01 237.65,736.17 C230.58,729.63 223.82,722.76 217.02,715.95 C204.69,702.16 193.34,687.52 182.53,672.52 C179.52,666.98 175.12,662.34 172.31,656.68 C168.64,648.97 163.74,641.93 159.71,634.41 C157.88,628.48 155.19,622.87 152.06,617.52 C148.39,610.04 145.69,602.13 142.56,594.42 C144.42,593.56 143.7,591.37 143.04,590.04 C142.47,591.29 142.12,592.62 142,594.02 C141.32,590.3 140.06,586.74 138.74,583.22 C132.38,563.26 127.36,542.81 124.74,522.01 C123.63,513.69 122.15,505.39 122.35,496.97 C121.2,481.34 121.07,465.62 122.32,450 C122.69,446.27 121.86,442.1 123.27,438.74 L123.78,438.92 C123.9,439.12 124.13,439.53 124.24,439.73 C124.06,438.16 123.8,436.59 123.88,435.02 C125.51,420.66 127.76,406.36 131.17,392.31 C132.93,384.29 135.58,376.51 137.53,368.54 C138.07,368.34 139.14,367.94 139.68,367.74 C148.14,376.19 156.98,384.26 166.53,391.47 C173.9,396.65 180.98,402.23 188.37,407.37 C214.5,424.41 242.12,439.1 270.44,452.12 C275.36,454.8 281.12,455.88 285.47,459.58 C285.63,460.55 285.48,461.48 285.02,462.36 C280.14,471.18 275.45,480.1 270.71,489.01 C268.83,492.14 267.14,495.38 265.96,498.85 C272.38,499.24 278.26,496.43 284.45,495.32 C290.07,494.23 295.25,491.57 300.97,490.91 C330.88,482.45 360.95,474.65 390.96,466.61 C398.19,465.19 405.05,462.29 412.36,461.25 C413.02,460.74 413.69,460.24 414.36,459.75 C420.09,459.65 425.17,456.57 430.85,456.14 C427.54,444.79 422.42,434.1 418.51,422.96 C410.23,402.06 402.21,381.06 394.16,360.07 C391.59,354.79 390.17,349.05 387.42,343.86 C383.19,331.13 377.81,318.82 373.1,306.26 C372.57,304.96 371.97,302.43 370,303.61 C368.4,305.71 367.38,308.15 366.22,310.5 C363.66,315.91 360.23,320.9 358.22,326.57 C353.75,332.85 350.61,339.94 347,346.72 C341.68,346.83 337.08,343.99 332.57,341.56 C311.33,331.02 292.33,316.68 273.43,302.51 C265.87,296.19 258.02,290.22 250.79,283.52 C236.28,269.5 221.71,255.44 209.19,239.59 C214.75,232.44 221.56,226.43 227.73,219.82 C234.31,213.69 240.66,207.25 247.87,201.82 C256.54,195.56 264.03,187.7 273.3,182.27 C284.58,175 295.32,166.67 307.74,161.34 C321.2,153.25 335.88,147.45 350.41,141.55 C364.38,136.5 378.57,131.96 393.04,128.54 Z"
      fill="#F9A332"
      id="Shape"
    />
    <path
      d="M169.81,135.46 C176.96,133.09 184.53,133.35 191.95,133.39 C199.98,133.6 208.11,132.71 216.02,134.51 C231.04,135.68 245.86,139.07 260.08,144 C271.02,147.54 281.99,151.05 292.53,155.7 C297.47,157.87 302.37,160.38 307.74,161.34 C295.32,166.67 284.58,175 273.3,182.27 C264.03,187.7 256.54,195.56 247.87,201.82 C240.66,207.25 234.31,213.69 227.73,219.82 C221.56,226.43 214.75,232.44 209.19,239.59 C190.6,216.04 174.27,189.17 170.05,158.95 C168.87,151.34 170.05,143.65 169.9,136.05 L169.81,135.46 Z"
      fill="#9D6B36"
      id="Shape"
    />
    <path
      d="M98.01,226.99 C117.94,193.74 142.7,163.59 169.9,136.05 C170.05,143.65 168.87,151.34 170.05,158.95 C174.27,189.17 190.6,216.04 209.19,239.59 C221.71,255.44 236.28,269.5 250.79,283.52 C258.02,290.22 265.87,296.19 273.43,302.51 C292.33,316.68 311.33,331.02 332.57,341.56 C337.08,343.99 341.68,346.83 347,346.72 C350.61,339.94 353.75,332.85 358.22,326.57 C360.23,320.9 363.66,315.91 366.22,310.5 C367.38,308.15 368.4,305.71 370,303.61 C371.97,302.43 372.57,304.96 373.1,306.26 C377.81,318.82 383.19,331.13 387.42,343.86 C390.17,349.05 391.59,354.79 394.16,360.07 C402.21,381.06 410.23,402.06 418.51,422.96 C422.42,434.1 427.54,444.79 430.85,456.14 C425.17,456.57 420.09,459.65 414.36,459.75 C413.69,460.24 413.02,460.74 412.36,461.25 C405.05,462.29 398.19,465.19 390.96,466.61 C360.95,474.65 330.88,482.45 300.97,490.91 C295.25,491.57 290.07,494.23 284.45,495.32 C278.26,496.43 272.38,499.24 265.96,498.85 C267.14,495.38 268.83,492.14 270.71,489.01 C275.45,480.1 280.14,471.18 285.02,462.36 C285.48,461.48 285.63,460.55 285.47,459.58 C281.12,455.88 275.36,454.8 270.44,452.12 C242.12,439.1 214.5,424.41 188.37,407.37 C180.98,402.23 173.9,396.65 166.53,391.47 C156.98,384.26 148.14,376.19 139.68,367.74 C138.92,366.96 138.18,366.18 137.45,365.39 C127.79,354.9 118.91,343.65 111.56,331.4 C98.45,312.63 87.9,291.94 81.7,269.84 C81.27,267.21 81.54,264.49 82.31,261.95 C85.45,249.47 91.76,238.13 98.01,226.99 Z"
      fill="#FEFEFE"
      id="Shape"
    />
    <path
      d="M763.83,181.04 C779.57,174.4 796.6,169.12 813.88,171 C816.61,171.57 819.58,171.47 822.09,172.77 C823.6,185.45 823.99,198.3 822.75,211.03 C821.94,230.97 816.66,250.42 809.98,269.12 C807.39,276.64 805,284.26 801.72,291.53 C798.75,298.39 796.65,305.8 792.46,312.03 C793.44,314.77 794.57,317.47 795.33,320.29 C792.21,315.86 790.77,310.57 788.19,305.86 C784.85,299.95 781.82,293.85 777.85,288.33 C771.56,277.21 763.94,266.94 756.48,256.6 C752.83,252.55 749.87,247.93 746.03,244.04 C735.94,233.12 726.88,220.99 714.74,212.17 C729.76,199.86 746.11,189.05 763.83,181.04 Z"
      fill="#9D6B36"
      id="Shape"
    />
    <path
      d="M137.45,365.39 C138.18,366.18 138.92,366.96 139.68,367.74 C139.14,367.94 138.07,368.34 137.53,368.54 C135.58,376.51 132.93,384.29 131.17,392.31 C127.76,406.36 125.51,420.66 123.88,435.02 C123.8,436.59 124.06,438.16 124.24,439.73 C124.13,439.53 123.9,439.12 123.78,438.92 C122.41,433.59 124.05,428.2 124.63,422.89 C126.9,403.33 132.12,384.29 137.45,365.39 Z"
      fill="#9D6B36"
      id="Shape"
    />
    <path
      d="M677.13,456.31 C679.59,455.25 682.27,455.05 684.94,455.1 C683.47,459.4 680.55,462.95 678.8,467.11 C675.17,475 670.01,482.18 667.2,490.41 C666.22,491.16 665.24,491.91 664.27,492.67 C664.61,494.07 664.95,495.71 666.56,496.19 C674.21,499.27 681.72,502.71 689.05,506.49 C697.61,510.85 706.51,514.54 714.83,519.37 C749.57,537.8 783.46,559.03 811.21,587.2 C821.28,597.87 830.42,609.41 838.14,621.91 C850.79,640.02 861.24,659.82 867.67,681.01 C870.31,687.94 867.41,695.29 865.13,701.9 C857.32,721.54 845.47,739.23 833.35,756.42 C821.14,772.97 808.37,789.18 794.14,804.04 C790.34,808.01 786.59,812.01 782.91,816.09 C781.62,818.03 779.64,819.48 777.3,819.8 C778.24,818.59 779.81,817.78 780.13,816.17 C782.46,799.02 778.81,781.51 772.16,765.68 C763.77,745.57 751.67,727.13 737.6,710.55 C732.46,704.3 726.61,698.64 721.81,692.13 C717.7,689.35 714.57,685.47 711,682.09 C708.29,679.51 705.7,676.82 703.45,673.83 C697.84,670.25 693.6,664.97 688.16,661.15 C676.01,650.82 663.4,641 650,632.35 C643.82,627.45 636.51,624.2 630.51,619.08 C628.6,618.54 626.68,617.96 625.05,616.82 C620.19,613.53 614.69,611.41 609.57,608.59 C607.82,607.56 605.79,607.37 603.83,607.15 C598.25,617.47 592.78,627.83 587.19,638.13 C584.35,642.84 582.52,648.16 578.81,652.31 C567.4,621.64 554.96,591.37 543.39,560.75 C539.63,552.17 536.54,543.31 533.18,534.58 C529.34,526 526.61,516.99 522.85,508.39 C521.78,505.09 520.78,501.78 520.06,498.4 C529.81,496.42 539.12,492.75 548.86,490.86 C591.57,479.23 634.34,467.65 677.13,456.31 Z"
      fill="#FEFEFE"
      id="Shape"
    />
    <path
      d="M434.04,524.76 C438.74,523.35 442.86,519.71 448.04,520.48 C450.19,530.01 452.53,539.51 455.44,548.85 C457.07,554.27 457.53,560.03 459.85,565.25 C462.18,576.6 466.28,587.54 468.19,598.97 C469.04,600.8 469.83,602.67 470.35,604.63 C475.83,624 480.65,643.54 485.97,662.96 C487.7,670.39 490.87,677.56 490.98,685.31 C481.43,681.01 472.53,675.37 463.22,670.58 C458.91,668.46 454.82,665.56 449.89,665.18 C449.6,667.48 449.33,669.79 449.08,672.11 C448.58,672.28 447.56,672.62 447.05,672.79 C444.15,679.73 441.07,686.59 437.4,693.16 C435.62,698.17 432.46,702.56 430.96,707.67 C425.42,716.68 420.84,726.26 415.39,735.33 C412,740.16 410,745.79 406.59,750.6 C403.03,755.49 400.63,761.28 395.89,765.24 C395.63,766.08 395.38,766.94 395.13,767.81 C393.95,769.3 392.77,770.81 391.7,772.39 C382.92,785.33 372.68,797.21 361.87,808.49 C352.73,817.13 343.35,825.62 332.87,832.63 C318.79,841.95 304.78,851.54 289.35,858.53 C280.01,862.75 270.43,866.76 260.39,869 C253.95,869.11 247.83,866.7 241.91,864.43 C226.53,857.8 212.12,849.13 198.37,839.6 C172.89,822.22 149.23,802.21 127.43,780.4 C134.96,780.79 142.54,781.84 150.04,780.49 C163.29,779.08 176,774.7 187.98,769.01 C206.03,760.54 222.33,748.82 237.65,736.17 C241.33,733.01 244.77,729.56 248.82,726.88 C254.25,720.26 260.47,714.23 267.05,708.77 C272.3,702.18 278.38,696.3 283.82,689.86 C296.72,674.56 308.49,658.33 319.52,641.63 C326.58,631.55 331.84,620.38 337.59,609.54 C338.53,607.87 338.6,605.93 338.85,604.1 C324.68,596.33 310.47,588.63 296.1,581.24 C296.21,580.37 296.41,578.61 296.52,577.73 C298.56,577.17 300.6,576.6 302.63,576.02 C309.8,572.55 317.39,570.03 324.82,567.19 C333.34,563.39 342.11,560.21 350.86,557 C359.79,553.09 369.13,550.23 378.03,546.24 C380.35,545.55 382.64,544.75 384.86,543.77 C392.34,540.51 400.14,538.06 407.66,534.88 C416.53,531.71 425.1,527.74 434.04,524.76 Z"
      fill="#FEFEFE"
      id="Shape"
    />
    <path
      d="M152.06,617.52 C155.19,622.87 157.88,628.48 159.71,634.41 C163.74,641.93 168.64,648.97 172.31,656.68 C175.12,662.34 179.52,666.98 182.53,672.52 C193.34,687.52 204.69,702.16 217.02,715.95 C223.82,722.76 230.58,729.63 237.65,736.17 C222.33,748.82 206.03,760.54 187.98,769.01 C176,774.7 163.29,779.08 150.04,780.49 C142.54,781.84 134.96,780.79 127.43,780.4 C127.25,780.39 126.89,780.37 126.7,780.36 C124.06,766.42 124.54,752.1 125.67,738.03 C126.91,717.58 132.5,697.7 139.65,678.61 C144.61,662.91 151.51,647.87 158.5,633.02 C157,627.66 153.19,623.09 152.06,617.52 Z"
      fill="#9D6B36"
      id="Shape"
    />
    <path
      d="M727.34,722.4 C730.92,718.58 735.43,715.5 737.6,710.55 C751.67,727.13 763.77,745.57 772.16,765.68 C778.81,781.51 782.46,799.02 780.13,816.17 C779.81,817.78 778.24,818.59 777.3,819.8 L776.99,820.14 C766.7,820.92 756.34,821.77 746.02,820.8 C740.3,820.9 734.63,820.34 729.04,819.15 C716.02,818.14 703.31,814.75 690.95,810.66 C682.03,808.05 673.24,805 664.76,801.2 C659.02,799.49 653.59,796.93 648.02,794.75 C643.82,792.8 639.81,790.28 635.12,789.68 C649.46,782.69 663.38,774.81 676.16,765.24 C681.51,761.18 687.52,758.02 692.51,753.48 C704.36,743.4 717.04,734.16 727.34,722.4 Z"
      fill="#9D6B36"
      id="Shape"
    />
  </svg>,
  'NexusMods',
);

function ChangeIDDialog({
  initialID,
  isClearable,
  onClear: onClearFromProps,
  onSubmit: onSubmitFromProps,
}: {
  initialID: string;
  isClearable: boolean;
  onClear: () => void;
  onSubmit: (id: string) => void;
}) {
  const { close: onClose } = usePersistentDialogContext();

  const [id, setID] = useState(initialID);

  const onChange = useCallback((event: React.ChangeEvent<HTMLInputElement>) => {
    setID(event.target.value);
  }, []);

  const onSubmit = useCallback(() => {
    onSubmitFromProps(id);
    onClose();
  }, [id, onClose, onSubmitFromProps]);

  const onClear = useCallback(() => {
    onClearFromProps();
    onClose();
  }, [onClearFromProps, onClose]);

  return (
    <Dialog fullWidth={true} onClose={onClose} open={true}>
      <DialogContent>
        <TextField
          autoFocus={true}
          fullWidth={true}
          label="Nexus Mods ID"
          onChange={onChange}
          sx={{ marginTop: 1 }}
          type="number"
          value={id}
          variant="outlined"
        />
        <DialogContentText sx={{ marginTop: 1 }} variant="caption">
          This ID can be found in the URL of the mod's Nexus Mods page.
        </DialogContentText>
        <DialogActions>
          {isClearable && <Button onClick={onClear}>Clear</Button>}
          <Button onClick={onClose}>Cancel</Button>
          <Button onClick={onSubmit} variant="contained">
            Save
          </Button>
        </DialogActions>
      </DialogContent>
    </Dialog>
  );
}

type Props = {
  mod: Mod;
};

export default function ModListNexusIDMenuItem({
  mod,
}: Props): JSX.Element | null {
  const [modConfigOverride, setModConfigOverride] = useModConfigOverride(
    mod.id,
  );
  const [, setModUpdate] = useModUpdate(mod.id);

  const nexusModID = getNexusModID(mod);
  const isOverriden = modConfigOverride?.website != null;
  const isOverridable =
    mod.info.type === 'd2rmm' && (nexusModID == null || isOverriden);

  const onSubmit = useCallback(
    (id: string) => {
      if (id == '') {
        return;
      }
      setModConfigOverride((oldOverride) => ({
        ...oldOverride,
        website: `https://www.nexusmods.com/diablo2resurrected/mods/${id}`,
      }));
    },
    [setModConfigOverride],
  );

  const onClear = useCallback(() => {
    setModConfigOverride((oldOverride) => {
      const newOverride = { ...oldOverride };
      delete newOverride.website;
      return newOverride;
    });
    // clear mod update state since we no longer know where to fetch updates from
    setModUpdate(null);
  }, [setModConfigOverride, setModUpdate]);

  const [onOpenDialog] = usePersistentDialog(
    <ChangeIDDialog
      initialID={nexusModID ?? ''}
      isClearable={isOverriden}
      onClear={onClear}
      onSubmit={onSubmit}
    />,
  );

  if (!isOverridable) {
    return null;
  }

  return (
    <ModListMenuItem
      icon={<NexusMods />}
      label="Nexus ID"
      onClick={onOpenDialog}
    />
  );
}
